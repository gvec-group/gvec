# GVEC 

## Overview

GVEC (Galerkin Variational Equilibrium Code) is an open-source software for
the generation of three-dimensional ideal MHD equilibria.
The ideas are strongly based on on the VMEC code, 
see [VMEC wiki pages](https://princetonuniversity.github.io/STELLOPT/VMEC).

The main features of GVEC are

* Use of modern **object-oriented FORTRAN**
* **Radial High Order B-spline** discretization: Splines with continuity `C^(deg-1)` or discontinuous polynomials
* **Number of Fourier modes** for each variable `X^1,X^2,lambda` can be chosen separately
* **Flexible choice of the mapping** between the space `(X^1,X^2,zeta)--> (x,y,z)` (in VMEC fixed to `(R,Z,phi)-->(x,y,z)` ) 
  to find equilibria in complex-shaped domains (magnetic islands, knotted domains...)
* A VMEC generated netcdf file can be used for initialization of GVEC.
* GVEC can convert its final solution to several formats (VMEC netcdf, specific converters) 

GVEC is being developed in the department of **Numerical Methods in Plasma Physics (NMPP)**
led by Prof. Eric Sonnendruecker at the Max Planck Institute for Plasma Physics 
in Garching, Germany.

The list of contributors is found in [CONTRIBUTORS.md](CONTRIBUTORS.md)

## License

GVEC is released under the terms of the GNU General Public License v3.0. 
For the full license terms see the included license file [LICENSE.md](LICENSE.md).

Copyright 2017-2024 GVEC Contributors | Max Planck Institute for Plasma Physics

## Documentation

 * a pdf that documents the [theory and implementation details](https://gitlab.mpcdf.mpg.de/gvec-group/GVEC_doc/blob/master/GVEC_prototype/GVEC_prototype.pdf) of GVEC
 * [user and developer documentation](https://gvec-group.pages.mpcdf.de/gvec) built with *sphinx*
 * auto-generated [fortran code documentation](https://gvec-group.pages.mpcdf.de/gvec/_static/ford/index.html) built with [FORD](https://forddocs.readthedocs.io/en/latest/)

## Getting started
 
### Get gvec as a clone from gitlab

To clone the GVEC repository, please make sure you have `git` and `git lfs` installed on your system. 

1.  You can clone the repository to a local folder.
    * Either you use the `https` address to clone, which always requests username and password when connecting to the mpcdf gitlab: 
      ```bash
      git clone https://gitlab.mpcdf.mpg.de/gvec-group/gvec.git gvec
      ```
    * Or you use the `git@` address to clone, in which case you have to copy your **public ssh key** of your machine to your profile on `gitlab.mpcdf.mpg.de` (typically its a `.pub` file in `~/.ssh`, generated by `ssh-keygen`). Then you do not have to specify any username or password.
      ```bash
      git clone git@gitlab.mpcdf.mpg.de:gvec-group/gvec.git gvec
      ```
1.  Now enter the created folder of the clone ( `cd gvec` )
1.  To change to the **latest release**, simply checkout `main` branch:
    ```bash
    git checkout main
    ```
    A list of branches on the remote is shown with `git branch -r`. You can change to a different branch of the GVEC repository (for a specific feature not yet available in the release) with:
    ```bash
    git checkout NAME_OF_BRANCH
    ```
1.  Since `git lfs` has been recently introduced, once you have GVEC cloned and the branch checked out, be sure to run in the `gvec` folder 
    ```bash
    git lfs install
    git lfs pull
    ```

### Installation

After setting up the git repository, follow the installation process: [For instructions see INSTALL.md](INSTALL.md).


### Run a GVEC example

After [installation](INSTALL.md), the binary executable should be found in `build/bin/gvec`. 
There are several example input files named `parameter.ini`, which are found in a subfolder of `test-CI/examples`.
*   For execution, go into one of these folders and execute for example the following commands
    ```bash
    cd test-CI/examples/ellipstell_lowres
    ../../../build/bin/gvec parameter.ini |tee log
    # (|tee pipes the screen output also into the file `log`)
    ``` 
*   You can also restart a simulation by using one of the restart files (`*_State_*.dat`). 
    Before the restart, resolution parameters in the `.ini` file can be changed, so that the new iterations will be on a finer grid, for example, or with more modes. The restart is triggered by simply adding the restart filename as an argument to the execution command, for example:
    ```bash 
    ../../build/bin/gvec parameter.ini ELLIPSTELL_State_0000_00000200.dat |tee log
    ``` 
    Then the first integer (`_0000_`) will be incremented for the newly written restart files. 
*   If you run gvec with the OpenMP parallelization, be sure to set the desired number of threads as an environment variable:
    ```bash
    #replace ??? by the number of threads you want to use
    export OMP_NUM_THREADS=???
    ```

### Visualization

For line plots, csv datafiles are generated (we like to use [veusz](https://veusz.github.io/) for plotting). 

For 3D data, we write `.vtu` files that can be visualized in [paraview](https://www.paraview.org).
